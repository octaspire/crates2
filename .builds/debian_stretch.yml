image: debian/bullseye
packages:
    - build-essential
    - curl
    - sbcl
sources:
    - https://git.sr.ht/~octaspire/crates2
tasks:
    - setup: |
        curl -O https://beta.quicklisp.org/quicklisp.lisp
        sbcl --load quicklisp.lisp --eval '(quicklisp-quickstart:install)' --eval '(ql-util:without-prompting (ql:add-to-init-file))' --eval '(quit)'
        mkdir -p ~/.config/common-lisp/source-registry.conf.d/
        cp crates2/etc/crates2.conf ~/.config/common-lisp/source-registry.conf.d/crates2.conf
    - test: |
        cd crates2
        make test
